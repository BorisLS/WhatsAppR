---
title: "WhatsAppR: Analyse von WhatsApp Chatverläufen"
author: "Boris Luetke Schelhowe"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

[WhatsApp](https://www.whatsapp.com/) ist ein 2009 gegründeter Instant-Messaging-Dienst. Dem Benutzer ist es möglich über WhatsApp über Textnachrichten, Bild-, Video- und Ton-Dateien sowie weitere Dokumente zwischen zwei Personen oder in Gruppen austauschen. 

WhatsApp ermöglicht es, dass der Chatverlauf eines bestimmten Chats oder einer Gruppe zu exportiert wird. Hierbei wird der Chatverlauf als txt-Datei exportiert und kann anschließend per E-Mail verschickt werden. 

[WhatsAppR](https://github.com/BorisLS/WhatsAppR) stellt verschiedene Funktionen zur Verfügung, um den exportierten Chatverlauf nach **R** zu importieren. Darüber hinaus sind Funktionen enthalten, um statistische Auswertungen durchzuführen.

## Exportieren eines WhatsApp-Chatverlauf
Eine Anleitung wie der Chatverlauf eines Chats als txt-Datei exportiert werden kann findet sich für das jeweilige Betriebssystem in den FAQs von [WhatsApp](https://www.whatsapp.com/faq/):  
- [Android](https://www.whatsapp.com/faq/de/android/23756533)  
- [iOS](https://www.whatsapp.com/faq/de/iphone/20888066#email)  

Als Einstellung ist hierbei der Export "Ohne Medien" zu wählen.


## Einbinden von WhatsAppR und weiteren benötigten Packages
Das **WhatsAppR**-package kann von [github](https://github.com/BorisLS/WhatsAppR) installiert werden. Hierfür wird die Funktion `install_github` aus dem [devtools](https://cran.r-project.org/web/packages/devtools/index.html)-Package verwendet. 

```{r, eval=FALSE}
devtools::install_github("BorisLS/WhatsAppR")
```

Im Anschluss kann **WhatsAppR** in R eingebunden werden. Es wird empfohlen zusätzlich auf das [dplyr](https://cran.r-project.org/web/packages/dplyr/index.html)-Package einzubinden.

```{r, warning=FALSE, error=FALSE, message=FALSE}
library(WhatsAppR)
library(dplyr)
```


## Importieren von WhatsApp-Chatverläufen
Die Funktion `wapp_import` wird verwendet um den Chatverlauf zu importieren. Für die Funktion werden drei Input-Parameter erwartet:  

- `history` Dateipfad mit dem Chatverlauf als txt-Datei  
- `language` Sprache der Systemeinstellung. Aktuell wird nur Deutsch 'de' unterstützt.  
- `techuser` Der Chatverlauf enthält verschiedene Systemnachrichten, z.B. wenn ein Chatmitglied in einem Gruppenchat hinzugefüght wurde. Es wird empfohlen diese Nachrichten aus den Analysen auszuschließen und die Einstellung `techuser = FALSE` zu wählen.

```{r}
test_chat <- wapp_import(history = 'C:/WhatsApp Chat mit Test-Chat.txt',
                         language = 'de',
                         techuser = FALSE)
```

```{r, include = FALSE}
test_chat <- test_chat %>%
             mutate(author = wapp_prep_author(author,
                                              author.old = c("boris luetke schelhowe", "Christian Haefner", 
                                                             "Sebastian Welling",  "Fabian Steghaus", "Jörg Schmitz",
                                                             "Manuel van de Kamp", "Stefan Haefner"),
                                               author.new = c("Bobby123", "Chris", "Seb", 
                                                              "Flo-BeerPong", "Jesse", "Marc", "Steve")))
```

Im Ergebnis ergibt sich nach dem Import das Dataframe `test_chat` mit sieben Spalten:

- `moment`:  POSIXct, Zeitpunkt des Postings 
- `day`:  Date, Tag des Postings
- `author`: chr, Name des Autors  
- `content`: chr, Inhalt des Postings  
- `rawdata`: chr, Ursprüngliche exportiere Zeile des Chatverlaufs  
- `message.length`: int, Anzahl der Zeichen der Nachricht  
- `type`: chr. Kennzeichnung, ob es sich um eine Textnachricht oder ob Dateien gepostet wurden

Manchmal kann es notwenig sein, die in WhatsApp verwendeten Namen anzupassen. Dies kann mit der Funktion `wapp_prep_author` erfolgen:  
```{r}
test_chat <- test_chat %>%
             mutate(author = wapp_prep_author(author,
                                              author.old = c("Bobby123", "Flo-BeerPong"),
                                              author.new = c("Bobby", "Flo")))
```

In diesem Beispiel soll nur das zurückliegende Jahr 2016 analysiert werden. Entsprechend muss der importierte Chatverlauf auf das Jahr 2016 eingeschränkt werden:
```{r}
test_chat <- test_chat %>%
             filter(day >= as.Date('2016-01-01'),
                    day <= as.Date('2016-12-31'))
```


## Analyse des Mengengerüsts des Chatverlaufs

### wapp\_stat\_author: Anzahl der Postings aufgeteilt nach Autor 
Möchte man wissen, welcher Autor wie viele Postings in dem Chatverlauf erstellt hat, kann die Funktion `wapp_stat_author` verwendet werden.
```{r, eval = FALSE}
test_chat %>%
  wapp_stat_author()
```
```{r, echo=FALSE}
kb <- test_chat %>% wapp_stat_author()
knitr::kable(kb)
```

In die *pipe* kann auch die Funktion `wapp_filter` eingebaut werden. Diese Funktion filtert den Chatverlauf entweder auf Textnachrichten (`type='message'`) oder Medien (`type='media'`). Mit Hilfe des folgenden Codes kann somit ausgewiesen werden, welcher Autor die meisten Medien (Bilder, Videos, o.ä.) gepostet hat.
```{r, eval = FALSE}
test_chat %>%
  wapp_filter(type = "media") %>%
  wapp_stat_author()
```
```{r, echo=FALSE}
kb <- test_chat %>% wapp_filter(type="media") %>% wapp_stat_author()
knitr::kable(kb)
```

### wapp\_stat\_date: Anzahl der Postings aufgeteilt nach dem Tag
Möchte man wissen, an welchen Tagen die Postings erstellt wurden, so kann hierfür die Funktion `wapp_stat_date` verwendet werden. Als weiterer Inputparamter werden die Anzahl der ausgewiesenen Tage `n` bentötigt. In diesem Beispiel sollen die 5 Tage mit den meisten Postings an Textnachrichten ausgewiesen werden.
```{r, eval=FALSE}
test_chat %>% 
  wapp_filter(type = "message") %>%
  wapp_stat_date(n = 5)
```
```{r, echo=FALSE}
kb <- test_chat %>% wapp_filter(type="message") %>% wapp_stat_date(n=5)
knitr::kable(kb)
```

Natürlich lassen sich auch weitere Funktionen aus der `dplyr`-Familie in die *pipe* einbauen. So kann zum Beispiel ermittelt, an welchem Tag ein bestimmter Autor die meisten Medien gepostet hat.
```{r, eval=FALSE}
test_chat %>% 
  filter(author == "Jesse") %>%
  wapp_filter(type = "media") %>%
  wapp_stat_date(n=1)
```
```{r, echo=FALSE}
kb <- test_chat %>% filter(author == "Jesse") %>% wapp_filter(type="media") %>% wapp_stat_date(n=1)
knitr::kable(kb)
```

### wapp\_stat\_time: Anzahl der Postings aufgeteilt nach Zeitintervallen
Die Funktion `wapp_stat_time` ermöglicht es eine Auswertung der Posts in einem bestimmten Zeitintervall durchzuführen. Es stehen hierfür verschiedene Zeitintervalle (z.B. Stunde, Monate, usw.) zur Verfügung.
```{r, eval=FALSE}
test_chat %>%
  wapp_filter(type = "message") %>%
  wapp_stat_time(interval = "quarter")
```
```{r, echo=FALSE}
kb <- test_chat %>% wapp_filter(type = "message") %>% wapp_stat_time(interval = "quarter")
knitr::kable(kb)
```

### wapp\_stat\_firstpost: Analyse, welcher Autor am häufigsten den ersten Post des Tages erstellt hat
Insbesondere in Gruppenchat existieren Personen einzelne Personen die meist den ersten Post des Tages durchführen und damit den Chatverlauf initiieren. Die Funktion `wapp_stat_firstpost` ermittelt, wie häufig ein Autor den ersten Post des Tages erstellt hat.
```{r, eval=FALSE}
test_chat %>%
  wapp_filter(type = "message") %>%
  wapp_stat_firstpost()
```
```{r, echo=FALSE}
kb <- test_chat %>% wapp_filter(type = "message") %>% wapp_stat_firstpost()
knitr::kable(kb)
```

## Analyse von Emoticons und Wörter

### wapp\_stat\_emoticons: Analyse wie häufig Emoticons verwendet wurden
Emoticons sind ein wichtiger Bestandteil in der Kommunikation mit WhatsApp. Die Funktion `wapp_stat_emoticons` ermöglicht es zu analysieren, wie häufig ein Autor bestimmte Emoticons verwendet hat.
```{r, eval=FALSE}
test_chat %>%
  wapp_stat_emoticons(author = "Steve", n = 5)
```
```{r, echo=FALSE}
kb <- test_chat %>% wapp_stat_emoticons(author = "Steve", n = 5)
knitr::kable(kb)
```

### wapp\_stat\_word: Analyse wie häufig ein bestimmtes Wort verwendet wurde
Mit der Funktion `wapp_stat_word` lässt sich analysieren, wie häufig ein bestimmtes Wort von einem Chatmitglied verwendet wurde. Der relevante Suchbegriff ist hierbei in Kleinbuchstaben einzugeben.
```{r, eval=FALSE}
test_chat %>%
  wapp_stat_word(word = "bier")
```
```{r, echo=FALSE}
kb <- test_chat %>% wapp_stat_word(word = "bier")
knitr::kable(kb)
```
